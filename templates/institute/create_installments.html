{% extends 'institute/base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<div class="content-card">
    <h1 class="mb-4" style="color: #1e3a8a;">
        <i class="fas fa-calendar-plus me-2"></i>Create Installments
    </h1>

    <div class="card border-0 shadow-sm">
        <div class="card-body">
            <form method="POST">
                {% csrf_token %}
                
                <!-- Student Selection -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <h5 class="mb-3" style="color: #1e3a8a;">
                            <i class="fas fa-user-graduate me-2"></i>Select Student
                        </h5>
                        
                        <div class="mb-3">
                            <label class="form-label">Search Student</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input type="text" id="studentSearch" class="form-control"
                                        placeholder="Search by name, admission ID, or mobile">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Or Select from List</label>
                            <select id="studentSelect" class="form-select" name="student_id" required>
                                <option value="">-- Select a student --</option>
                                {% for student in students %}
                                <option value="{{ student.id }}">
                                    {{ student.admission_id }} - {{ student.student_name }} ({{ student.course }})
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Installment Details -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <h5 class="mb-3" style="color: #1e3a8a;">
                            <i class="fas fa-money-check-alt me-2"></i>Installment Details
                        </h5>
                        
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead class="table-light">
                                    <tr>
                                        <th>Installment</th>
                                        <th>Amount (â‚¹)</th>
                                        <th>Due Date</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Installment 1</td>
                                        <td>
                                            <input type="number" name="installment1_amount" 
                                                    class="form-control" step="0.01" min="0">
                                        </td>
                                        <td>
                                            <input type="date" name="installment1_date" 
                                                    class="form-control">
                                        </td>
                                        <td>
                                            <input type="text" name="installment1_desc" 
                                                    class="form-control" placeholder="Description">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Installment 2</td>
                                        <td>
                                            <input type="number" name="installment2_amount" 
                                                    class="form-control" step="0.01" min="0">
                                        </td>
                                        <td>
                                            <input type="date" name="installment2_date" 
                                                    class="form-control">
                                        </td>
                                        <td>
                                            <input type="text" name="installment2_desc" 
                                                    class="form-control" placeholder="Description">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Installment 3</td>
                                        <td>
                                            <input type="number" name="installment3_amount" 
                                                    class="form-control" step="0.01" min="0">
                                        </td>
                                        <td>
                                            <input type="date" name="installment3_date" 
                                                    class="form-control">
                                        </td>
                                        <td>
                                            <input type="text" name="installment3_desc" 
                                                    class="form-control" placeholder="Description">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Installment 4</td>
                                        <td>
                                            <input type="number" name="installment4_amount" 
                                                    class="form-control" step="0.01" min="0">
                                        </td>
                                        <td>
                                            <input type="date" name="installment4_date" 
                                                    class="form-control">
                                        </td>
                                        <td>
                                            <input type="text" name="installment4_desc" 
                                                    class="form-control" placeholder="Description">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Installment 5</td>
                                        <td>
                                            <input type="number" name="installment5_amount" 
                                                    class="form-control" step="0.01" min="0">
                                        </td>
                                        <td>
                                            <input type="date" name="installment5_date" 
                                                    class="form-control">
                                        </td>
                                        <td>
                                            <input type="text" name="installment5_desc" 
                                                    class="form-control" placeholder="Description">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Installment 6</td>
                                        <td>
                                            <input type="number" name="installment6_amount" 
                                                    class="form-control" step="0.01" min="0">
                                        </td>
                                        <td>
                                            <input type="date" name="installment6_date" 
                                                    class="form-control">
                                        </td>
                                        <td>
                                            <input type="text" name="installment6_desc" 
                                                    class="form-control" placeholder="Description">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Notes -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="form-label">Additional Notes</label>
                            <textarea name="notes" class="form-control" rows="3" 
                                    placeholder="Any additional notes about these installments..."></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- Submit Button -->
                <div class="mt-4">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save me-1"></i> Create Installments
                    </button>
                    <button type="reset" class="btn btn-secondary ms-2">
                        <i class="fas fa-redo me-1"></i> Reset
                    </button>
                    <a href="{% url 'account_section' %}" class="btn btn-outline-primary ms-2">
                        <i class="fas fa-arrow-left me-1"></i> Back to Accounts
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Search functionality for students
    const studentSearch = document.getElementById('studentSearch');
    const studentSelect = document.getElementById('studentSelect');
    
    if (studentSearch) {
        studentSearch.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const options = studentSelect.options;
            
            for (let i = 0; i < options.length; i++) {
                const option = options[i];
                const text = option.text.toLowerCase();
                if (text.includes(searchTerm) || searchTerm === '') {
                    option.style.display = '';
                } else {
                    option.style.display = 'none';
                }
            }
        });
    }
    
    // Auto-fill installment amounts based on course
    if (studentSelect) {
        studentSelect.addEventListener('change', function() {
            // Here you can add logic to fetch student's course and 
            // auto-calculate installment amounts
            // For now, it's a placeholder
            console.log('Student selected:', this.value);
        });
    }
});
</script>

<style>
.table th {
    background-color: #f8f9fa;
    color: #1e3a8a;
    font-weight: 600;
}

.table input {
    border: 1px solid #ced4da;
    border-radius: 4px;
    padding: 8px 12px;
    width: 100%;
}

.table input:focus {
    border-color: #86b7fe;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}
</style>
{% endblock %}